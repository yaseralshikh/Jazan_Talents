
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background-color: #f0f6ff;
      padding: 30px;
    }
    .header, .card-filters {
      background-color: #ffffff;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      background-color: #007bff;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h2 {
      margin: 0;
      font-size: 1.8rem;
    }
    .header img {
      height: 60px;
      filter: brightness(0) invert(1);
    }
    .table-card {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    #schoolNameTitle {
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 15px;
      text-align: center;
    }
    .btn-print {
      position: absolute;
      top: 0;
      left: 0;
      margin: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    thead {
      background-color: #007bff;
      color: white;
    }

    @media print {
      .header, .card-filters, .btn-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
      <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1568x1192.png" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" />
    </div>

    <div class="card-filters row mb-3">
      <div class="col-md-4">
        <label for="sectorSelect">Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…:</label>
        <select class="form-select" id="sectorSelect">
          <option value="">Ø§Ø®ØªØ± Ù‚Ø·Ø§Ø¹Ù‹Ø§</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="stageSelect">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
        <select class="form-select" id="stageSelect">
          <option value="">Ø§Ø®ØªØ± Ù…Ø±Ø­Ù„Ø©</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="schoolSelect">Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</label>
        <select class="form-select" id="schoolSelect">
          <option value="">Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³Ø©</option>
        </select>
      </div>
    </div>

    <div class="table-card" id="dataTable">

    <div class="text-start mb-3 d-flex gap-2">
      <button class="btn btn-outline-success" onclick="exportPDF()">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</button>
<button class="btn btn-outline-primary" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button></div>
      
      <div id="schoolNameTitle"></div>
      <div class="table-responsive" id="table_div"></div>
    </div>
  </div>

  <script>
    google.charts.load("current", { packages: ["table"] });
    google.charts.setOnLoadCallback(loadData);

    let allData;
    let dataTable;

    const spreadsheetId = "10R3flKxq0TRXFM7W2K7xoLRxWpNmtu68xEti7d1HP_U";
    const sheetName = "Data";
    const sheetUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?sheet=${sheetName}`;

    function loadData() {
      fetch(sheetUrl)
        .then((res) => res.text())
        .then((rep) => {
          const jsonData = JSON.parse(rep.substring(47).slice(0, -2));
          dataTable = new google.visualization.DataTable(jsonData.table);
          allData = dataTable;
          populateFilters();
          filterAndDraw();
        });
    }

    function populateFilters() {
      const sectorSelect = document.getElementById("sectorSelect");
      const stageSelect = document.getElementById("stageSelect");

      const sectors = new Set();
      const stages = new Set();

      for (let i = 0; i < allData.getNumberOfRows(); i++) {
        sectors.add(allData.getValue(i, 0));
        stages.add(allData.getValue(i, 1));
      }

      sectors.forEach((s) => {
        sectorSelect.innerHTML += `<option value="${s}">${s}</option>`;
      });

      stages.forEach((s) => {
        stageSelect.innerHTML += `<option value="${s}">${s}</option>`;
      });

      sectorSelect.addEventListener("change", () => {
        updateSchoolDropdown();
        filterAndDraw();
      });

      stageSelect.addEventListener("change", () => {
        updateSchoolDropdown();
        filterAndDraw();
      });

      document.getElementById("schoolSelect").addEventListener("change", filterAndDraw);
    }

    function updateSchoolDropdown() {
      const sector = document.getElementById("sectorSelect").value;
      const stage = document.getElementById("stageSelect").value;
      const schoolSelect = document.getElementById("schoolSelect");
      schoolSelect.innerHTML = `<option value="">Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³Ø©</option>`;

      const schools = new Set();

      for (let i = 0; i < allData.getNumberOfRows(); i++) {
        const currentSector = allData.getValue(i, 0);
        const currentStage = allData.getValue(i, 1);
        const currentSchool = allData.getValue(i, 2);

        if (
          (!sector || currentSector === sector) &&
          (!stage || currentStage === stage)
        ) {
          schools.add(currentSchool);
        }
      }

      schools.forEach((school) => {
        schoolSelect.innerHTML += `<option value="${school}">${school}</option>`;
      });
    }

    function filterAndDraw() {
      const sector = document.getElementById("sectorSelect").value;
      const stage = document.getElementById("stageSelect").value;
      const school = document.getElementById("schoolSelect").value;

      document.getElementById("schoolNameTitle").innerText = school || "";

      const filteredRows = [];

      for (let i = 0; i < allData.getNumberOfRows(); i++) {
        const matchSector = !sector || allData.getValue(i, 0) === sector;
        const matchStage = !stage || allData.getValue(i, 1) === stage;
        const matchSchool = !school || allData.getValue(i, 2) === school;

        if (matchSector && matchStage && matchSchool) {
          filteredRows.push(i);
        }
      }

      const view = new google.visualization.DataView(allData);
      view.setRows(filteredRows);
      view.setColumns([3, 4, 5, 6, 7]);

      const numberedData = [["#", "Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨", "Ø§Ù„ØµÙ", "Ø§Ù„ØªØµÙ†ÙŠÙ"]];
      for (let i = 0; i < view.getNumberOfRows(); i++) {
        numberedData.push([
          i + 1,
          view.getValue(i, 0) || "",
          view.getValue(i, 3) || "",
          view.getValue(i, 4) || "",
        ]);
      }

      let html = "<table><thead><tr>";
      numberedData[0].forEach((h) => (html += `<th>${h}</th>`));
      html += "</tr></thead><tbody>";
      for (let i = 1; i < numberedData.length; i++) {
        html += "<tr>";
        numberedData[i].forEach((cell) => (html += `<td>${cell}</td>`));
        html += "</tr>";
      }
      html += "</tbody></table>";
      document.getElementById("table_div").innerHTML = html;
    }
  </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
<script>
  function exportPDF() {
    const title = document.getElementById("schoolNameTitle").innerText || "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨";
    const table = document.querySelector("#table_div table");
    if (!table) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");

    const headers = Array.from(table.querySelectorAll("thead th")).map(th => th.innerText.trim());
    const rows = Array.from(table.querySelectorAll("tbody tr")).map(tr =>
      Array.from(tr.querySelectorAll("td")).map(td => td.innerText.trim())
    );

    const body = [headers, ...rows];

    const docDefinition = {
      content: [
        { text: title, style: "header", alignment: "center", margin: [0, 0, 0, 10] },
        {
          table: {
            headerRows: 1,
            body: body
          },
          layout: "lightHorizontalLines"
        }
      ],
      defaultStyle: {
        font: "Amiri",
        alignment: "right"
      },
      styles: {
        header: {
          fontSize: 16,
          bold: true
        }
      }
    };

    pdfMake.createPdf(docDefinition).download("students.pdf");
  }

  // Cairo font definition
  
</script>
</body>

</html>
